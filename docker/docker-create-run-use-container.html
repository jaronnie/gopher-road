<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>运行我们的第一个容器并使用容器 | gopher-road</title>
    <meta name="generator" content="VuePress 1.9.8">
    <link rel="icon" href="favicon-gopher-road.ico">
    <meta name="description" content="golang 后端之路">
    
    <link rel="preload" href="/assets/css/0.styles.b569aa3e.css" as="style"><link rel="preload" href="/assets/js/app.a569fc54.js" as="script"><link rel="preload" href="/assets/js/3.69626d1e.js" as="script"><link rel="preload" href="/assets/js/20.7a108302.js" as="script"><link rel="prefetch" href="/assets/js/10.df2cdd86.js"><link rel="prefetch" href="/assets/js/11.c732068a.js"><link rel="prefetch" href="/assets/js/12.f153aeca.js"><link rel="prefetch" href="/assets/js/13.cfc7e3a4.js"><link rel="prefetch" href="/assets/js/14.e7a41867.js"><link rel="prefetch" href="/assets/js/15.4e032a83.js"><link rel="prefetch" href="/assets/js/16.38b08b92.js"><link rel="prefetch" href="/assets/js/17.e381b989.js"><link rel="prefetch" href="/assets/js/18.b80804d0.js"><link rel="prefetch" href="/assets/js/19.1d1b8b72.js"><link rel="prefetch" href="/assets/js/21.fb600637.js"><link rel="prefetch" href="/assets/js/22.0657b0f5.js"><link rel="prefetch" href="/assets/js/23.40de456a.js"><link rel="prefetch" href="/assets/js/24.be46fe84.js"><link rel="prefetch" href="/assets/js/25.c63fdf4c.js"><link rel="prefetch" href="/assets/js/26.178036d4.js"><link rel="prefetch" href="/assets/js/27.fe4059b8.js"><link rel="prefetch" href="/assets/js/28.5b497215.js"><link rel="prefetch" href="/assets/js/29.424d089d.js"><link rel="prefetch" href="/assets/js/30.73ab42fe.js"><link rel="prefetch" href="/assets/js/31.dfafa29e.js"><link rel="prefetch" href="/assets/js/32.1fbac27c.js"><link rel="prefetch" href="/assets/js/33.ea711dab.js"><link rel="prefetch" href="/assets/js/34.b5c6a614.js"><link rel="prefetch" href="/assets/js/35.1e285bae.js"><link rel="prefetch" href="/assets/js/36.93daa1f9.js"><link rel="prefetch" href="/assets/js/37.54d3b8f6.js"><link rel="prefetch" href="/assets/js/38.b1a4b909.js"><link rel="prefetch" href="/assets/js/39.9c002036.js"><link rel="prefetch" href="/assets/js/4.dc3531a1.js"><link rel="prefetch" href="/assets/js/40.085d071e.js"><link rel="prefetch" href="/assets/js/41.b560cb9c.js"><link rel="prefetch" href="/assets/js/42.1f752891.js"><link rel="prefetch" href="/assets/js/43.46b09747.js"><link rel="prefetch" href="/assets/js/44.44f5c41e.js"><link rel="prefetch" href="/assets/js/45.f72a195b.js"><link rel="prefetch" href="/assets/js/46.8d3f61f4.js"><link rel="prefetch" href="/assets/js/47.0df3d11b.js"><link rel="prefetch" href="/assets/js/48.6e269e06.js"><link rel="prefetch" href="/assets/js/49.597e5805.js"><link rel="prefetch" href="/assets/js/5.59e57075.js"><link rel="prefetch" href="/assets/js/50.aef8848d.js"><link rel="prefetch" href="/assets/js/51.5a389f30.js"><link rel="prefetch" href="/assets/js/52.81bc3cde.js"><link rel="prefetch" href="/assets/js/53.838482ed.js"><link rel="prefetch" href="/assets/js/54.fa3d2d2e.js"><link rel="prefetch" href="/assets/js/55.bd3dc534.js"><link rel="prefetch" href="/assets/js/56.5e8b88ae.js"><link rel="prefetch" href="/assets/js/57.21585acc.js"><link rel="prefetch" href="/assets/js/58.7f25518e.js"><link rel="prefetch" href="/assets/js/59.edf10519.js"><link rel="prefetch" href="/assets/js/6.32784090.js"><link rel="prefetch" href="/assets/js/60.06411168.js"><link rel="prefetch" href="/assets/js/61.33bf8a73.js"><link rel="prefetch" href="/assets/js/62.79aec9b8.js"><link rel="prefetch" href="/assets/js/63.e3c402cb.js"><link rel="prefetch" href="/assets/js/64.c4568709.js"><link rel="prefetch" href="/assets/js/65.e8e1dea3.js"><link rel="prefetch" href="/assets/js/66.0ce59038.js"><link rel="prefetch" href="/assets/js/67.654d0792.js"><link rel="prefetch" href="/assets/js/68.79a25102.js"><link rel="prefetch" href="/assets/js/69.89338747.js"><link rel="prefetch" href="/assets/js/7.710c65d8.js"><link rel="prefetch" href="/assets/js/70.c44ceb61.js"><link rel="prefetch" href="/assets/js/71.1c15e4fe.js"><link rel="prefetch" href="/assets/js/72.4e1e9e33.js"><link rel="prefetch" href="/assets/js/8.8b43199c.js"><link rel="prefetch" href="/assets/js/9.d83e729c.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.d5d1cb4b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b569aa3e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://oss.jaronnie.com/logo.jpeg" alt="gopher-road" class="logo"> <span class="site-name can-hide">gopher-road</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/golang/" class="nav-link">
  golang
</a></div><div class="nav-item"><a href="/linux/" class="nav-link">
  linux
</a></div><div class="nav-item"><a href="/algorithms/" class="nav-link">
  算法与数据结构
</a></div><div class="nav-item"><a href="/codeManage/" class="nav-link">
  代码管理
</a></div><div class="nav-item"><a href="/middleware/" class="nav-link">
  中间件
</a></div><div class="nav-item"><a href="/docker/" class="nav-link router-link-active">
  docker
</a></div><div class="nav-item"><a href="/kubernetes/" class="nav-link">
  kubernetes
</a></div><div class="nav-item"><a href="/project/" class="nav-link">
  项目实战
</a></div><div class="nav-item"><a href="/recommendation/" class="nav-link">
  推荐阅读
</a></div><div class="nav-item"><a href="https://github.com/jaronnie/gopher-road" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/golang/" class="nav-link">
  golang
</a></div><div class="nav-item"><a href="/linux/" class="nav-link">
  linux
</a></div><div class="nav-item"><a href="/algorithms/" class="nav-link">
  算法与数据结构
</a></div><div class="nav-item"><a href="/codeManage/" class="nav-link">
  代码管理
</a></div><div class="nav-item"><a href="/middleware/" class="nav-link">
  中间件
</a></div><div class="nav-item"><a href="/docker/" class="nav-link router-link-active">
  docker
</a></div><div class="nav-item"><a href="/kubernetes/" class="nav-link">
  kubernetes
</a></div><div class="nav-item"><a href="/project/" class="nav-link">
  项目实战
</a></div><div class="nav-item"><a href="/recommendation/" class="nav-link">
  推荐阅读
</a></div><div class="nav-item"><a href="https://github.com/jaronnie/gopher-road" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/docker/what-is-docker.html" class="sidebar-link">什么是Docker?</a></li><li><a href="/docker/docker-install.html" class="sidebar-link">docker安装</a></li><li><a href="/docker/docker-create-run-use-container.html" aria-current="page" class="active sidebar-link">运行我们的第一个容器并使用容器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docker/docker-create-run-use-container.html#查看docker是否安装" class="sidebar-link">查看docker是否安装</a></li><li class="sidebar-sub-header"><a href="/docker/docker-create-run-use-container.html#配置镜像源" class="sidebar-link">配置镜像源</a></li><li class="sidebar-sub-header"><a href="/docker/docker-create-run-use-container.html#运行第一个容器" class="sidebar-link">运行第一个容器</a></li><li class="sidebar-sub-header"><a href="/docker/docker-create-run-use-container.html#创建守护式容器" class="sidebar-link">创建守护式容器</a></li><li class="sidebar-sub-header"><a href="/docker/docker-create-run-use-container.html#在容器内部运行进程" class="sidebar-link">在容器内部运行进程</a></li><li class="sidebar-sub-header"><a href="/docker/docker-create-run-use-container.html#停止正在运行的容器" class="sidebar-link">停止正在运行的容器</a></li><li class="sidebar-sub-header"><a href="/docker/docker-create-run-use-container.html#自动重启容器" class="sidebar-link">自动重启容器</a></li></ul></li><li><a href="/docker/docker-build-image.html" class="sidebar-link">构建自己的镜像</a></li><li><a href="/docker/docker-dockerfile.html" class="sidebar-link">Dockerfile</a></li><li><a href="/docker/docker-practice-ubuntu-ssh.html" class="sidebar-link">docker实战一：用docker构建可ssh登录的ubuntu等容器</a></li><li><a href="/docker/docker-practice-mysql.html" class="sidebar-link">docker实战二：运行mysql容器</a></li><li><a href="/docker/docker-manage-image-container.html" class="sidebar-link">docker 镜像和容器管理</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="运行我们的第一个容器并使用容器"><a href="#运行我们的第一个容器并使用容器" class="header-anchor">#</a> 运行我们的第一个容器并使用容器</h1> <p>教程所使用的环境</p> <p><img src="http://oss.jaronnie.com/image-20210307200220343.png" alt="image-20210307200220343"></p> <h2 id="查看docker是否安装"><a href="#查看docker是否安装" class="header-anchor">#</a> 查看docker是否安装</h2> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> info
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>Client:
 Context:    default
 Debug Mode: <span class="token boolean">false</span>
 Plugins:
  app: Docker App <span class="token punctuation">(</span>Docker Inc., v0.9.1-beta3<span class="token punctuation">)</span>
  buildx: Build with BuildKit <span class="token punctuation">(</span>Docker Inc., v0.5.1-docker<span class="token punctuation">)</span>

Server:
 Containers: <span class="token number">15</span>
  Running: <span class="token number">1</span>
  Paused: <span class="token number">0</span>
  Stopped: <span class="token number">14</span>
 Images: <span class="token number">6</span>
 Server Version: <span class="token number">20.10</span>.2
 Storage Driver: overlay2
  Backing Filesystem: extfs
  Supports d_type: <span class="token boolean">true</span>
  Native Overlay Diff: <span class="token boolean">true</span>
 Logging Driver: json-file
 Cgroup Driver: cgroupfs
 Cgroup Version: <span class="token number">1</span>
 Plugins:
  Volume: <span class="token builtin class-name">local</span>
  Network: bridge <span class="token function">host</span> ipvlan macvlan null overlay
  Log: awslogs fluentd gcplogs gelf journald json-file <span class="token builtin class-name">local</span> logentries splunk syslog
 Swarm: inactive
 Runtimes: runc io.containerd.runc.v2 io.containerd.runtime.v1.linux
 Default Runtime: runc
 Init Binary: docker-init
 containerd version: 269548fa27e0089a8b8278fc4fc781d7f65a939b
 runc version: ff819c7e9184c13b7c2607fe6c30ae19403a7aff
 init version: de40ad0
 Security Options:
  apparmor
  seccomp
   Profile: default
 Kernel Version: <span class="token number">4.19</span>.0-10-amd64
 Operating System: Debian GNU/Linux <span class="token number">10</span> <span class="token punctuation">(</span>buster<span class="token punctuation">)</span>
 OSType: linux
 Architecture: x86_64
 CPUs: <span class="token number">1</span>
 Total Memory: <span class="token number">1</span>.948GiB
 Name: iZ2zeg3h4a24fht4sr97x1Z
 ID: X3U6:MMCR:ZIXP:YLOQ:A4FR:F5VU:CHTZ:DDCJ:QZEH:YBLS:Z37F:OCH7
 Docker Root Dir: /var/lib/docker
 Debug Mode: <span class="token boolean">false</span>
 Username: gocloudcoder
 Registry: https://index.docker.io/v1/
 Labels:
 Experimental: <span class="token boolean">false</span>
 Insecure Registries:
  <span class="token number">127.0</span>.0.0/8
 Registry Mirrors:
  https://docker.mirrors.ustc.edu.cn/
 Live Restore Enabled: <span class="token boolean">false</span>

</code></pre></div><p>我们使用了docker可执行程序的info命令，该命令会返回所有容器和镜像的数量，Docker使用的执行驱动和存储驱动，以及Docker的基本配置。</p> <h2 id="配置镜像源"><a href="#配置镜像源" class="header-anchor">#</a> 配置镜像源</h2> <p>配置文件保存在<code>/etc/docker/daemon.json</code>中，如果没有就创建此文件。</p> <p>文件内容如下：</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">{</span>
        <span class="token string">&quot;registry-mirrors&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>修改完地址后，重新加载配置文件，重启docker服务</p> <div class="language-shell extra-class"><pre class="language-shell"><code>systemctl daemon-reload
systemctl restart <span class="token function">docker</span>
</code></pre></div><h2 id="运行第一个容器"><a href="#运行第一个容器" class="header-anchor">#</a> 运行第一个容器</h2> <p>我们可以使用docker run命令创建容器。它的功能是提供了Docker容器的创建到启动。</p> <p><img src="http://oss.jaronnie.com/image-20210307235009406.png" alt="image-20210307235009406"></p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> run <span class="token parameter variable">-i</span> <span class="token parameter variable">-t</span> ubuntu /bin/bash
</code></pre></div><p>指定-i -t两个参数，-i表示interactive，-t表示tty伪终端。</p> <p>它告诉Docker为要创建的容器分配一个伪tty终端，这样我们能够与之进行交互，而不是一个运行后台服务的容器。</p> <p>我们可以使用<code>man docker-run</code>查看run命令所有的参数使用。</p> <p>然后我们告诉Docker基于什么镜像来创建容器，示例使用的是ubuntu镜像。它可以称为一个基础(base)镜像。它由Docker公司提供，保存在Docker Hub Registry中。但是由于我们使用的镜像源是ustc(中国科学技术大学)，所以实际上是从ustc中获取的。</p> <p>在运行这个命令的时候，Docker首先会检查本地上是否存在ubuntu:latest镜像，其中latest代表版本(tag)。如果本地没有的话，将会从镜像源搜索是否有该镜像，如果有，将下载该镜像并保存在本地宿主机中。</p> <p>随后，Docker在文件系统内部用这个镜像创建了一个新容器，该容器拥有自己的网络，IP地址，以及一个用来和宿主机进行通信的桥接网络接口。最后，我们告诉Docker在容器中要运行什么命令。我们使用了是/bin/bash命令，即启动了一个bash shell。</p> <p>退出该容器使用<code>exit</code></p> <p>我们再精简一下这个命令。不启动交互式的终端，并执行ls命令。</p> <p><img src="http://oss.jaronnie.com/image-20210308070132830.png" alt="image-20210308070132830"></p> <p>那这个容器运行以及就终止了。</p> <p>我们使用docker ps -a查看所有的容器，docker ps查看正在运行中的容器。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>CONTAINER ID   IMAGE          COMMAND                  CREATED        STATUS                    PORTS     NAMES
c3fbd9db71fd   ubuntu         <span class="token string">&quot;ls&quot;</span>                     <span class="token number">15</span> hours ago   Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">15</span> hours ago             xenodochial_beaver
2638a8f44bff   ubuntu         <span class="token string">&quot;/bin/bash&quot;</span>              <span class="token number">15</span> hours ago   Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">38</span> hours ago             nostalgic_colden
</code></pre></div><p>我们使用docker images查看镜像</p> <div class="language-shell extra-class"><pre class="language-shell"><code>REPOSITORY    TAG       IMAGE ID       CREATED         SIZE
ubuntu        latest    f643c72bc252   <span class="token number">3</span> months ago    <span class="token number">72</span>.9MB
</code></pre></div><p>即基于一个ubuntu镜像，我们创建了两个容器。每run一次，就会创建一个容器。</p> <p>那我们如何进入之前创建的容器呢？</p> <p>我们可以使用restart命令重启容器，并使用attach进入该容器。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> restart 2638a8f44bff
<span class="token function">docker</span> attach 2638a8f44bff
</code></pre></div><p>这一串ID记不住是个问题，我们可以指定一个name。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token function">rename</span> 2638a8f44bff ubuntu1
<span class="token function">docker</span> restart ubuntu1
<span class="token function">docker</span> attach ubuntu1
</code></pre></div><p>当然我们也可以在run的时候就指定容器的名字。使用--name选项</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span>  <span class="token function">docker</span> run <span class="token parameter variable">-i</span> <span class="token parameter variable">-t</span> <span class="token parameter variable">--name</span> ubuntu2 ubuntu /bin/bash
</code></pre></div><p>此时我们再使用docker ps -a</p> <div class="language-shell extra-class"><pre class="language-shell"><code>CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS                          PORTS     NAMES
174065c2336f   ubuntu         <span class="token string">&quot;/bin/bash&quot;</span>              <span class="token number">48</span> seconds ago   Exited <span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">)</span> <span class="token number">6</span> seconds ago                ubuntu2
c3fbd9db71fd   ubuntu         <span class="token string">&quot;ls&quot;</span>                     <span class="token number">16</span> hours ago     Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">16</span> hours ago                   xenodochial_beaver
2638a8f44bff   ubuntu         <span class="token string">&quot;/bin/bash&quot;</span>              <span class="token number">39</span> hours ago     Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> About a minute ago             ubuntu1
</code></pre></div><p>基于同一个镜像我们一共创建了3个容器。</p> <p>那如何删除容器呢？可以使用rm命令。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token function">rm</span> ubuntu1
<span class="token function">docker</span> <span class="token function">rm</span> c3fbd9db71fd
</code></pre></div><p>如果我们连ubuntu镜像都不要，可以使用rmi命令。</p> <p>由于ubuntu镜像又分为各种版本，所以删除的时候需要带上tag</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> rmi ubuntu:latest
</code></pre></div><p><img src="http://oss.jaronnie.com/image-20210309151146187.png" alt="image-20210309151146187"></p> <p>由于ubuntu2容器还在依赖这个镜像，所以无法删除。</p> <p>先删除ubuntu2容器，才能删除ubuntu:latest镜像。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token function">rm</span> ubuntu2
<span class="token function">docker</span> rmi ubuntu:latest
</code></pre></div><p><img src="http://oss.jaronnie.com/image-20210309151308966.png" alt="image-20210309151308966"></p> <h2 id="创建守护式容器"><a href="#创建守护式容器" class="header-anchor">#</a> 创建守护式容器</h2> <p>在某些场景下，我们需要创建长期运行的容器，必须让他在后台运行才可以。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> run <span class="token parameter variable">-i</span> <span class="token parameter variable">-t</span> <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> ubuntu666 ubuntu <span class="token builtin class-name">echo</span> <span class="token string">&quot;hello world&quot;</span>
</code></pre></div><p><img src="http://oss.jaronnie.com/image-20210309152121185.png" alt="image-20210309152121185"></p> <p>使用-d选项，可以创建守护式容器，只返回容器ID。</p> <p>我们可以使用日志logs命令，获取容器的日志。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> logs ubuntu666
</code></pre></div><p>就可以看到hello world。</p> <h2 id="在容器内部运行进程"><a href="#在容器内部运行进程" class="header-anchor">#</a> 在容器内部运行进程</h2> <p>我们可以使用exec命令在容器内部额外启动新进程。</p> <p>可以在容器内运行的进程分为后台任务和交互式任务。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> run <span class="token parameter variable">-i</span> <span class="token parameter variable">-t</span> <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> ubuntu123 ubuntu
</code></pre></div><p>docker ps查看，ubuntu123正在后台运行。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>CONTAINER ID   IMAGE         COMMAND                  CREATED         STATUS                  PORTS     NAMES
ab99a424b7d8   ubuntu        <span class="token string">&quot;/bin/bash&quot;</span>              <span class="token number">5</span> seconds ago   Up <span class="token number">4</span> seconds                      ubuntu123
</code></pre></div><p><img src="http://oss.jaronnie.com/image-20210309202831399.png" alt="image-20210309202831399"></p> <p>我们使用exec命令让容器新开一个进程执行一个任务。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> ubuntu123 <span class="token builtin class-name">echo</span> hello
</code></pre></div><p><img src="http://oss.jaronnie.com/image-20210309202956904.png" alt="image-20210309202956904"></p> <p>使用exec命令让容器后台执行一个任务。在/root下创建hello.txt文件。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-d</span> ubuntu123 <span class="token function">touch</span> /root/hello.txt
</code></pre></div><p><img src="C:%5CUsers%5C%E7%83%A8%E8%BD%A9%E5%A2%A8%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210309205110318.png" alt="image-20210309205110318"></p> <div class="language-shell extra-class"><pre class="language-shell"><code>注意：
使用docker attach进入容器之后，使用exit退出后，容器也不再运行在后台了。
一般我们使用docker exec进入容器交互终端。exit之后容器还在运行！
</code></pre></div><p>使用exec命令执行交互式任务。</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> start ubuntu123
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-i</span> <span class="token parameter variable">-t</span> ubuntu123 /bin/bash
</code></pre></div><p><img src="http://oss.jaronnie.com/image-20210309210157402.png" alt="image-20210309210157402"></p> <h2 id="停止正在运行的容器"><a href="#停止正在运行的容器" class="header-anchor">#</a> 停止正在运行的容器</h2> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> stop ubuntu123
</code></pre></div><h2 id="自动重启容器"><a href="#自动重启容器" class="header-anchor">#</a> 自动重启容器</h2> <p>当由于某种错误或者宿主机重启等造成容器停止运行，那对应的服务也将停止。</p> <p>我们应该设置容器可以自动重启。使用--restart=always标记。</p> <p>首先我们删除ubuntu123容器。</p> <div class="language- extra-class"><pre class="language-text"><code>docker rm ubuntu123
</code></pre></div><p>重新创建一个容器。无论容器退出的代码是什么，将会自动重启该容器。</p> <div class="language-shell extra-class"><pre class="language-shell"><code> <span class="token function">docker</span> run <span class="token parameter variable">--restart</span><span class="token operator">=</span>always <span class="token parameter variable">-i</span> <span class="token parameter variable">-t</span> <span class="token parameter variable">--name</span> ubuntu123 ubuntu /bin/bash
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/jaronnie/gopher-road/edit/main/docs/docker/docker-create-run-use-container.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/18/2023, 9:00:42 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docker/docker-install.html" class="prev">
        docker安装
      </a></span> <span class="next"><a href="/docker/docker-build-image.html">
        构建自己的镜像
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.a569fc54.js" defer></script><script src="/assets/js/3.69626d1e.js" defer></script><script src="/assets/js/20.7a108302.js" defer></script>
  </body>
</html>
