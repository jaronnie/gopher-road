(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{292:function(t,s,a){"use strict";a.r(s);var n=a(10),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"实战-go-module-使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实战-go-module-使用"}},[t._v("#")]),t._v(" 实战 go module 使用")]),t._v(" "),s("p",[t._v("作为一个 gopher，对于 go module 的一些规则还是要明白的，否则工作中会遇到一些问题。")]),t._v(" "),s("p",[t._v("或许我们已经习惯了使用别人已经开发好的包，我们只需要 "),s("code",[t._v("go get")]),t._v(" 即可。")]),t._v(" "),s("p",[t._v("但是 如果不搞清楚 go module 的一些规则，我们在使用的过程中就会出现一些问题。")]),t._v(" "),s("p",[t._v("另外，在公司中开发项目的时候，我们需要写一个 package 供其他模块使用，那么就必须要搞清楚 go module 的机制了。")]),t._v(" "),s("p",[t._v("下面我们就从开发一个 package 来实战 go module 的各种机制。")]),t._v(" "),s("h2",{attrs:{id:"环境准备"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#环境准备"}},[t._v("#")]),t._v(" 环境准备")]),t._v(" "),s("ul",[s("li",[t._v("go（GO111MODULE=on）")]),t._v(" "),s("li",[t._v("git")]),t._v(" "),s("li",[t._v("github")])]),t._v(" "),s("h2",{attrs:{id:"初始化-package"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#初始化-package"}},[t._v("#")]),t._v(" 初始化 package")]),t._v(" "),s("blockquote",[s("p",[t._v("注意：请将 jaronnie 替换成你自己的 github 用户名")])]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" tourmod\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" tourmod\ngo mod init github.com/jaronnie/tourmod\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("touch")]),t._v(" tour.go\n")])])]),s("p",[t._v("在 "),s("code",[t._v("tour.go")]),t._v("中写入如下内容：")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" tourmod\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\tversion "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"v0.1.0"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" version\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" init\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" *\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" commit "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"v0.1.0"')]),t._v("\n")])])]),s("p",[t._v("然后在 github 上创建一个仓库，仓库名为 tourmod。")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" remote "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" origin git@github.com:jaronnie/tourmod.git\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" push "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-u")]),t._v(" origin master\n")])])]),s("p",[t._v("此时，可以在 github 上看到如下内容：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://resource.gocloudcoder.com/image-20210822135145682.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"版本管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#版本管理"}},[t._v("#")]),t._v(" 版本管理")]),t._v(" "),s("p",[t._v("首先初始化我们的项目，需要依赖上面我们写的 package.")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" mytour\n"),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" mytour\ngo mod init mytour\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("touch")]),t._v(" main.go\n")])])]),s("p",[t._v("在 main.go 中写入如下内容：")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmt"')]),t._v("\n\n\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/jaronnie/tourmod"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tfmt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tourmod"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("然后 go get 下载模块：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[t._v("go get github.com/jaronnie/tourmod\n")])])]),s("p",[s("img",{attrs:{src:"https://resource.gocloudcoder.com/image-20210822135941366.png",alt:""}})]),t._v(" "),s("p",[t._v("此时查看 go.mod 文件的内容.")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://resource.gocloudcoder.com/image-20210822140432205.png",alt:""}})]),t._v(" "),s("p",[t._v("由于我们没有指定版本，而且我们的仓库中没有打 tag，所以 go module 按照自己的内部规则进行拉取。其中 v0.0.0 是版本信息，一串数字是拉取版本的 commit 时间，后面的字符串为所拉取版本的 commit 哈希值。")]),t._v(" "),s("p",[t._v("下面我们发布我们的第一个正式版 "),s("code",[t._v("v1.0.0")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" tourmod\n")])])]),s("p",[t._v("修改 tour.go 的内容为如下：")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" tourmod\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\tversion "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"v1.0.0"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" version\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" *\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" commit "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"v1.0.0"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" push "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-u")]),t._v(" origin master\n")])])]),s("p",[t._v("可以看到：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://resource.gocloudcoder.com/image-20210822141300914.png",alt:""}})]),t._v(" "),s("p",[t._v("下面我们为此次提交的代码打一个 tag：")]),t._v(" "),s("p",[t._v("点击 create a new release.")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://resource.gocloudcoder.com/image-20210822141521858.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://resource.gocloudcoder.com/image-20210822141546091.png",alt:""}})]),t._v(" "),s("p",[t._v("v1.0.0 发布成功，下面我们进入我们写项目目录：")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" mytour\ngo get github.com/jaronnie/tourmod@v1.0.0\n")])])]),s("p",[s("img",{attrs:{src:"https://resource.gocloudcoder.com/image-20210822142117320.png",alt:""}})]),t._v(" "),s("p",[t._v("可以看到，版本替换成功。此时运行 "),s("code",[t._v("go run main.go")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://resource.gocloudcoder.com/image-20210822142213472.png",alt:""}})]),t._v(" "),s("p",[t._v("现在由于某种原因，我们对 package 进行了一个重大的重构，版本从 v1 上升到 v2.")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" tourmod\n")])])]),s("p",[t._v("修改 "),s("code",[t._v("tour.go")]),t._v("为如下内容：")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" tourmod\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\tversion "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"v2.0.0"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" version\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("p",[t._v("修改 go.mod 为：")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[t._v("module github"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("jaronnie"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("tourmod"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("v2\n")])])]),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" *\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" commit "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-m")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"v2.0.0"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" push "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-u")]),t._v(" origin master\n")])])]),s("p",[t._v("再来打一个 tag：")]),t._v(" "),s("p",[s("img",{attrs:{src:"https://resource.gocloudcoder.com/image-20210822142938912.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"https://resource.gocloudcoder.com/image-20210822143102782.png",alt:""}})]),t._v(" "),s("p",[t._v("再进入我们的 mytour 项目")]),t._v(" "),s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" mytour\n")])])]),s("p",[t._v("修改 go.mod 为：")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[t._v("module mytour\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("go")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.16")]),t._v("\n\nrequire github"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("jaronnie"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("tourmod"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("v2 v2"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.0")]),t._v("\n")])])]),s("p",[t._v("执行 "),s("code",[t._v("go mod tidy")]),t._v(" 将会把版本替换为 v2.0.0")]),t._v(" "),s("p",[t._v("修改 main.go 为如下内容：")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("package")]),t._v(" main\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"fmt"')]),t._v("\n\n\t"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"github.com/jaronnie/tourmod/v2"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tfmt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("tourmod"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("h2",{attrs:{id:"go-package-发布版本的一些规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#go-package-发布版本的一些规则"}},[t._v("#")]),t._v(" go package 发布版本的一些规则")]),t._v(" "),s("p",[t._v("一般来说，格式为如下：")]),t._v(" "),s("p",[t._v("v1.2.3-xxx")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("1 为主版本号（做不了兼容的api修改）")])]),t._v(" "),s("li",[s("p",[t._v("2 为次版本包（做了向下兼容的功能性新增）")])]),t._v(" "),s("li",[s("p",[t._v("3 为修订号：做了向下兼容的问题修正")])]),t._v(" "),s("li",[s("p",[t._v("xxx 为一些自己设置的环境，如 v1.2.3-develop，为 develop环境")])])]),t._v(" "),s("p",[t._v("打 tag 的时候，如果未遵循规则，该版本是无法使用 go get 拉取的。")]),t._v(" "),s("p",[t._v("如果发布了 v2 开头的一些版本，那么 go.mod 文件需要在尾部加上 /v2，否则无法被正常拉取。")]),t._v(" "),s("p",[t._v("如 "),s("code",[t._v("module github.com/jaronnie/tourmod/v2")])]),t._v(" "),s("p",[t._v("在使用该库的时候，也需要在尾部加上 /v2")]),t._v(" "),s("p",[t._v("如 "),s("code",[t._v('import "github.com/jaronnie/tourmod/v2"')])])])}),[],!1,null,null,null);s.default=e.exports}}]);